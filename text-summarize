#!/usr/bin/env python3

import sys
import openai
from paragraph_processing_functions import extract_key_points

# Main function
def main(input_file):
    try:
        # Step 1: Read file
        with open(input_file, 'r') as f:
            content = f.read()
        
        # Step 2: Split into paragraphs
        paragraphs = [p for p in content.split("\n\n") if p.strip()]
        
        # Step 3 and 4: Process each paragraph and collect summaries
        summaries = []
        for i, paragraph in enumerate(paragraphs, start=1):
            print(f"Processing paragraph {i} of {len(paragraphs)}")
            # summary = summarize_paragraph(paragraph)
            summary = extract_key_points(paragraph)
            summaries.append(summary)
        
        # Step 5: Write summaries to a new text file
        output_file = input_file.split('.')[0] + "-summary.txt"
        with open(output_file, 'w') as f:
            for summary in summaries:
                f.write(summary + "\n\n")
        
        print(f"Summaries have been saved in {output_file}")

    except Exception as e:
        print(f"An error occurred: {e}")

if __name__ == "__main__":
    openai.api_key_path = '/Users/marekkowalczyk/repos/text-summarize/config/text-summarize.txt'
    if len(sys.argv) != 2:
        print("Usage: python script.py <input_file>")
    else:
        main(sys.argv[1])
